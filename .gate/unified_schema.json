{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["policy"],
  "properties": {
    "policy": {
      "type": "object",
      "required": ["version", "environments"],
      "properties": {
        "version": { "type": "string" },
        "metadata": {
          "type": "object",
          "properties": {
            "description": { "type": "string" },
            "last_updated": { "type": "string", "format": "date" }
          },
          "additionalProperties": true
        },
        "environments": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "required": ["enabled", "rules"],
            "properties": {
              "enabled": { "type": "boolean" },
              "rules": {
                "type": "object",
                "required": [
                  "approvals_required",
                  "allowed_branches",
                  "require_ticket",
                  "tests_passed",
                  "signed_off",
                  "max_deployments_per_day"
                ],
                "properties": {
                  "approvals_required": { 
                    "type": "integer", 
                    "minimum": 0
                  },
                  "allowed_branches": {
                    "type": ["array", "null"],
                    "items": { "type": "string" }
                  },
                  "require_ticket": { "type": "boolean" },
                  "ticket_pattern": { 
                    "type": "string",
                    "format": "regex"
                  },
                  "tests_passed": { "type": "boolean" },
                  "signed_off": { "type": "boolean" },
                  "max_deployments_per_day": { 
                    "type": "integer",
                    "minimum": 0
                  },
                  "pr_rules": {
                    "type": "object",
                    "properties": {
                      "require_code_owner_review": { "type": "boolean" },
                      "required_status_checks": {
                        "type": "array",
                        "items": { "type": "string" }
                      },
                      "enforce_admins": { "type": "boolean" },
                      "required_linear_ticket": { "type": "boolean" },
                      "min_reviewers": { 
                        "type": "integer",
                        "minimum": 0
                      },
                      "require_up_to_date_branch": { "type": "boolean" }
                    },
                    "additionalProperties": false
                  }
                },
                "additionalProperties": false
              }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
